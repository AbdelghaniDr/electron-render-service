language: node_js
sudo: required

services:
  - docker

env:
  - RENDERER_ACCESS_KEY=secret CONCURRENCY=1 WINDOW_WIDTH=1024 WINDOW_HEIGHT=768 ELECTRON_ENABLE_STACK_DUMPING=true ELECTRON_ENABLE_LOGGING=true

node_js:
  - "5.10"

before_script:
  - "mkdir -p ~/.docker && echo $DOCKER_AUTH > ~/.docker/config.json"
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3 # give xvfb some time to start

script:
  - npm run lint
  - npm test

after_success:
  - export REPO=msokk/electron-render-service
  - docker build -t $REPO .
  - if [ ! -z "$TRAVIS_TAG" ]; then docker tag $REPO:latest $REPO:$TRAVIS_TAG; fi
  - docker push $REPO
